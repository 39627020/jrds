<project name="jrds" default="compile" basedir=".">
	<!-- set global properties for this build -->
	<property name="app.name"      value="jrds"/>
	<property name="app.path"      value="/${app.name}"/>
	<property name="app.version"   value="0.1-dev"/>
	<property name="build.home"    value="${basedir}/build"/>
	<property name="docs.build"    value="${build.home}/docs"/>
	<property name="src.home"      value="${basedir}/src"/>
	<property name="web.src"       value="${basedir}/web"/>
	<property name="web.build"     value="${build.home}/webapp"/>

	<!--  ==================== Compilation Control Options ==================== -->
	<property name="compile.debug"       value="true"/>
	<property name="compile.deprecation" value="false"/>
	<property name="compile.optimize"    value="true"/>

	<!-- ===================== Catalina Classpath =========================== -->
	<property name="catalina.home" value="/Library/Tomcat"/>
	<path id="catalina.classpath">
	    <pathelement location="${catalina.home}/common/classes"/>
		<fileset dir="${catalina.home}/common/endorsed">
      		<include name="*.jar"/>
    	</fileset>
    	<fileset dir="${catalina.home}/common/lib">
      		<include name="*.jar"/>
    	</fileset>
    	<pathelement location="${catalina.home}/shared/classes"/>
    	<fileset dir="${catalina.home}/shared/lib">
      		<include name="*.jar"/>
    	</fileset>
	</path>


	<!-- ==================== Run Classpath =========================== -->
	<path id="project.classpath">
		<fileset dir="lib">
      		<include name="*.jar"/>
    		</fileset>
	</path>

	<!-- ==================== Compilation Classpath =========================== -->
	<path id="compile.classpath">
		<path refid="catalina.classpath" />
		<path refid="project.classpath" />
	</path>

	<import file="local.xml" optional="true" />

	<target name="compile">
		<mkdir dir="${build.home}/classes" />

	    <javac srcdir="${src.home}"
	           destdir="${build.home}/classes"
	            debug="${compile.debug}"
                    deprecation="${compile.deprecation}"
                    optimize="${compile.optimize}"
	    	    encoding="iso-8859-1"
	    	    target="1.4">
                    <classpath refid="compile.classpath"/>
	    </javac>
		<copy todir="${build.home}/classes">
			<fileset dir="${src.home}">
				<include name="**/*.xml"/>
				<include name="**/*.xsl"/>
			</fileset>
		</copy>
	</target>

	<target name="appjar" depends="compile">
		<jar destfile="${build.home}/jrds.jar" basedir="${build.home}/classes" manifest="${basedir}/MANIFEST.MF" />
	</target>

	<target name="javadoc">
		<javadoc destdir="${docs.build}" access="protected" use="true" notree="false" nonavbar="false" noindex="false" splitindex="true" author="true" version="true" nodeprecatedlist="false" nodeprecated="false" packagenames="jrds.probe,jrds.probe.snmp,jrds.snmp,jrds,jrds.probe.munins,jrds.graphe" sourcepath="src" >
			<classpath refid="compile.classpath"/>
			<link href="http://java.sun.com/j2se/1.4.2/docs/api"/>
			<link href="http://java.sun.com/products/servlet/2.3/javadoc"/>
			<link href="http://www.snmp4j.org/doc"/>
			<link href="http://www.jrobin.org/javadoc"/>
        		<link href="http://logging.apache.org/log4j/docs/api"/>
   			<link href="http://www.mathcs.emory.edu/dcl/util/backport-util-concurrent/doc/api"/>
			<link href="http://remotetea.sourceforge.net/javadoc"/>
        </javadoc>
    </target>

	<target name="clean" description="clean up" >
		<delete dir="${build.home}"/>
	</target>

	<target name="srctar" depends="javadoc">
		<tar destfile="${build.home}/${app.name}-src.tar">
			<tarfileset dir="." prefix="jrds">
				<include name="build" />
				<include name="build/classes" />
				<include name="MANIFEST.MF" />
				<include name="src/**" />
				<include name="web/**" />
				<include name="build.xml"/>
				<include name="web.xml"/>
				<include name="lib/**"/>
				<include name="${docs.build}/**"/>
			</tarfileset>
		</tar>
	</target>

    <target name="apptar" depends="appjar">
        <tar destfile="${build.home}/${app.name}.tar">
            <tarfileset dir="." prefix="jrds">
                <include name="lib/**"/>
            </tarfileset>
            <tarfileset dir="${build.home}" prefix="jrds/lib">
                <include name="jrds.jar"/>
            </tarfileset>
            <tarfileset dir="${build.home}" prefix="jrds">
                <include name="jrds.war"/>
            </tarfileset>
        </tar>
    </target>

	<target name="war" depends="appjar">
		<war destfile="${build.home}/${app.name}.war" webxml="${basedir}/web.xml" duplicate="preserve">
			<lib dir="lib">
				<include name="*.jar"/>
			</lib>
			<lib dir="${build.home}">
				<include name="*.jar"/>
			</lib>
			<webinf dir="lib/">
				<include name="c.tld" />
			</webinf>
			<fileset dir="${web.src}" />
		</war>
	</target>

	<!--  ==================== A few target to run jrds ==================== -->
	<target name="collect" depends="appjar">
		<java  classname="jrds.standalone.Collector" fork="true">
			<classpath>
				<pathelement location="${build.home}/jrds.jar"/>
				<path refid="project.classpath" />
			</classpath>
		</java>
	</target>

	<target name="test" depends="appjar">
		<java  classname="jrds.standalone.TestSumGraph" fork="true">
			<classpath>
				<pathelement location="${build.home}/jrds.jar"/>
				<path refid="project.classpath" />
			</classpath>
		</java>
	</target>

	<target name="graph" depends="appjar">
		<java  classname="jrds.standalone.Grapher" fork="true">
			<classpath>
				<path refid="project.classpath" />
				<pathelement location="${build.home}/${app.name}.jar"/>
			</classpath>
		</java>
	</target>

</project>
